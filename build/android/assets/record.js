function getText(e){return null==e?"":"string"==typeof e?e.unescapeEntities():"object"==typeof e?e.list?"string"==typeof e.list[0]?e.list[0]:e.list[0].content:e.content?e.content.unescapeEntities():"":""}var OAI=require("de.appwerft.oaipmh"),abx=require("com.alcoapps.actionbarextras");module.exports=function(e){var i=JSON.parse(e.itemId).url,a=JSON.parse(e.itemId).id;console.log(JSON.parse(e.itemId));var t=Ti.UI.createTabGroup({scrollable:!1,title:Ti.App.Properties.hasProperty(a)?Ti.App.Properties.getString(a):a,tabs:[Ti.UI.createTab({title:"metadata",window:Ti.UI.createWindow()}),Ti.UI.createTab({title:"header",window:Ti.UI.createWindow()})]}),o=t.tabs[0].window;t.tabs[1].window;t.open(),t.addEventListener("open",function(){t.activity.actionBar.displayHomeAsUp=!0,abx.setStatusbarColor("#003"),t.activity.actionBar.onHomeIconItemSelected=function(e){t.close()}});var n=OAI.createProvider({url:i});n.GetRecord({metadataPrefix:"oai_dc",identifier:a},function(e){var i=e["OAI-PMH"].GetRecord.record.metadata["oai_dc:dc"],a=(e["OAI-PMH"].GetRecord.record.header,[]);abx.setTitle(getText(i["dc:publisher"])),abx.setSubtitle(getText(i["dc:title"]));var t=Object.getOwnPropertyNames(i);t.forEach(function(e){if(void 0!=i[e]){var t=Ti.UI.createTableViewSection({headerTitle:e}),o=Ti.UI.createTableViewRow({height:Ti.UI.SIZE,backgroundColor:"#003"}),n=getText(i[e]);o.add(Ti.UI.createLabel({text:n,left:5,top:5,right:5,bottom:10,color:"white",font:{fontSize:18}})),t.add(o),a.push(t)}}),o.add(Ti.UI.createTableView({data:a}))},function(e){Ti.UI.createNotification({duration:5e3,message:e.message}).show()}),t.open()};